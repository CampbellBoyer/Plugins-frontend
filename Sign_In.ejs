<!DOCTYPE html>
<html>
<head>
  <title>Sign Into</title>
  <%- include('header'); %>
  <!-- Facebook SDK -->
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId            : '408871246386479',
        autoLogAppEvents : true,
        xfbml            : true,
        version          : 'v3.3'
      });
    };
  </script>
  <script async defer src="https://connect.facebook.net/en_US/sdk.js"></script>
</head>
<body>

  <!-- Sign In -->
  <div class="uk-padding uk-position-relative uk-position-small uk-position-top-center uk-text-center">
  <h3 id="alumni_name" class="norwester">Fern Creek <br> Alumni Association</h3>
  </div>

  <div class="uk-flex uk-flex-center">
      <div class="uk-width-1-4"></div>
      <div class="uk-width-1-1 uk-width-1-3@m ">

        <div class="uk-container uk-container-expand uk-position-relative uk-padding-large white border-slate">
          <h2 class="uk-text-center">Sign In</h2>
          <button class="uk-button facebook uk-width-1-1" onclick="facebookLogin()"><span uk-icon="facebook"></span> Sign in with Facebook</button>
          <hr class="uk-divider-icon">
        <div>
          <h4 class="uk-text-center">Sign in with Email</h4><br>
              <div class="uk-inline uk-width-1-1">
                <span class="uk-form-icon" uk-icon="icon: mail"></span>
                <input id="email-input" class="uk-input border-charcoal2" placeholder="Email Address" type="text">
              </div>
            <div class="uk-margin">
              <div class="uk-inline uk-width-1-1">
                  <span class="uk-form-icon" uk-icon="icon: lock"></span>
                  <input id="password-input" class="uk-input border-charcoal2" placeholder="Password" type="password">
              </div>
          </div>
        <button class="uk-button button-dk" onclick="login()">Sign In</a>
      </div>
</div>
</div>
      <div class="uk-width-1-4"></div>
  </div>


  <div class="uk-padding uk-position-relative uk-position-bottom-center uk-text-center">
  <h4 class="uk-inline uk-margin-right uk-margin-top">Not a member? </h4> <a class="uk-button button-lt uk-inline" href="/">Create An Account</a>
  </div>

  <script type="text/javascript">
    function login() {
      $.ajax({
        url: '/api/login',
        type: 'POST',
        data: {
          email: $('#email-input').val(),
          password: $('#password-input').val()
        },
        success: function(data) {
          if (data.redirect) {
            window.location.pathname = data.redirect;
          } else {
            window.location.pathname = '/profile';
          }
        },
        error: function(req, err) {
          alert(err);
        }
      });
    }

    function facebookLogin() {
      FB.login(function(response) {
        if (response.authResponse) {
          $.ajax({
            url: '/api/login-with-facebook',
            type: 'POST',
            data: response.authResponse,
            success: function(data) {
              if (data.redirect) {
                window.location.pathname = data.redirect;
              } else {
                window.location.pathname = '/profile';
              }
            },
            error: function(err) {
              alert(err);
            }
          })
        } else {
         console.log('User cancelled login or did not fully authorize.');
        }
      }, {
        scope: 'email,user_birthday'
      });
    }
  </script>
  </body>
</html>
