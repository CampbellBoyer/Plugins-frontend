<!DOCTYPE html>
<html>
<head>
  <title>Membership Types</title>
  <%- include('header'); %>
</head>
<body>
  <div id="app">
    <!-- Membership Options -->
    <div class="uk-padding uk-position-relative uk-position-small uk-position-top-center uk-text-center">
      <h3 id="alumni_name" class="norwester"><%= site_header %></h3>
    </div>
    <hr class="uk-divider-icon">
    <h2 class="uk-text-center tight">Membership Types</h2>
    <h5 class="uk-text-center tight">Select a membership type to purchase one.</h5>
    <div class="uk-padding-large">
      <div class="uk-child-width-1-2@m" uk-grid data-uk-grid-match>
        <% membershipTypes.forEach((membershipType) => { %>
        <div>
          <div class="uk-card-small uk-card-default">
            <div class="uk-card-header"><h2 class="uk-card-title uk-text-center"><%= membershipType.name %></h2></div>
            <div class="uk-card-body" style="white-space: pre-line">
              <%= membershipType.description %>
            </div>
            <div class="uk-button uk-width-1-1" id="<%- 'paypal-button-' + membershipType.id %>"></div>
          </div>
          <% if (membershipType.price > 0) { %>
          <script type="text/javascript">
            paypal.Buttons({
              createOrder: function(data, actions) {
                return actions.order.create({
                  purchase_units: [{
                    amount: {
                      value: '<%= membershipType.price %>',
                      currency: 'USD'
                    }
                  }]
                });
              },
              onApprove: function(data, actions) {
                return actions.order.capture().then(function(details) {
                  axios.post('/api/process-membership-subscription', {
                    orderId: data.orderID,
                    membershipType: <%= membershipType.id %>
                  })
                    .then(function(data) {
                      alert('Membership processed successfully.');
                      window.location.href = data.redirect ? data.redirect : '/profile';
                    })
                    .catch(function(err) {
                      alert('We were unable to process your transaction. Please try again or contact an administrator.');
                    });
                });
              },
              style: {
                color: 'blue',
                shape: 'rect',
                size: 'responsive',
                fundingincons: false
              }
            }).render('<%- "#paypal-button-" + membershipType.id %>');
          </script>
          <% } else { %>
          <script>
            $('<%- "#paypal-button-" + membershipType.id %>').html('<button type="button" style="width: 100%; height: 55px; margin-bottom: 15px; border: 0px; border-radius: 4px; background-color: #009CDE; color: white; font-size: 1.2em; cursor: pointer;"><i><b>Select</b></i></button>');
            $('<%- "#paypal-button-" + membershipType.id %>').click(function() {
                  axios.post('/api/process-membership-subscription', {
                    membershipType: <%= membershipType.id %>
                  })
                    .then(function(data) {
                      alert('Membership updated successfully.');
                      window.location.href = data.redirect ? data.redirect : '/profile';
                    })
                    .catch(function(err) {
                      alert('We were unable to process your transaction. Please try again or contact an administrator.');
                    });
            });
          </script>
          <% } %>
        </div>
        <% });%>
      </div>
      <a class="uk-margin-large uk-button button-lt uk-align-center uk-width-1-3" href="/profile">Skip for Now</a>
    </div>
  </div>
  
  <%- include('footer') %>
</body>
</html>
