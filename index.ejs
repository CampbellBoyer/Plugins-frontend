<!DOCTYPE html>
<html>
<head>
  <title>Alumni Association Web App</title>
  <%- include('header'); %>
  <script>
    window.fbAsyncInit = function() {
      FB.init({
        appId            : <%= facebookAppId %>,
        autoLogAppEvents : true,
        xfbml            : true,
        version          : 'v3.3'
      });
    };
  </script>
  <script async defer src="https://connect.facebook.net/en_US/sdk.js"></script>
</head>
<body>    
  <!-- Sign Up -->
  <div class="uk-padding uk-position-relative uk-position-small uk-position-top-center uk-text-center">
  <h1 id="alumni_name" class="tight">Fern Creek</h1>
  <h3 class="norwester tight">Alumni Association</h3>
  </div>

  <div class="uk-container uk-container-expand uk-margin-large-left uk-margin-large-right uk-position-relative uk-padding-large white border-charcoal">

    <div class="uk-grid-divider uk-child-width-expand@s" uk-grid>
      <!-- Facebook Option -->
      <div>
        <h4>Log in via Facebook <i class="font-hint">(Recommended)</i></h4>
        <button class="uk-button facebook" onclick="facebookLogin()"><span uk-icon="facebook"></span> Connect with Facebook</button>
        <h5>Benefits:<br>- Faster Login<br>- No extra passwords to remember<br>- View which of your friends are members<br></h5>
      </div>
        <!-- Create new Account Option-->
      <div>
        <div class="uk-position-relative uk-margin-large-bottom">
          <h4>Already a member? &nbsp;</h4><button class="uk-button button-lt uk-button-small"><a href="/sign-in">Sign In</a></button>
        </div>
        <h4 class="tight">Create an Account</h4><br>
            <div class="uk-inline">
              <span class="uk-form-icon" uk-icon="icon: mail"></span>
              <input id="email-input" class="uk-input border-charcoal2" placeholder="Email Address" type="text">
            </div>
          <div class="uk-margin">
            <div class="uk-inline">
                <span class="uk-form-icon" uk-icon="icon: lock"></span>
                <input id="password-input" class="uk-input border-charcoal2" placeholder="Password" type="password">
            </div>
        </div>
        <div class="uk-margin">
          <div class="uk-inline">
              <span class="uk-form-icon" uk-icon="icon: lock"></span>
              <input id="confirm-password" class="uk-input border-charcoal2" placeholder="Confirm Password" type="password">
          </div>
        </div>
        <h6>By creating an account, you agree to our <a target="_blank" href="https://www.alumnimanagementtools.com/privacy-terms-and-conditions">Terms of Service</a> and <a target="_blank" href="https://www.alumnimanagementtools.com/privacy-terms-and-conditions">Privacy Policy</a></h6>
        <button class="uk-button button-dk" onclick="validateAndCreateAccount()">Create Account</button>
      </div>
    </div>
  </div>

  <div class="uk-margin-large-bottom"></div>
  <%- include('footer'); %>
  <script type="text/javascript">
    function createAccount() {
      axios.post('/api/create-account', {
        email: $('#email-input').val(),
        password: $('#password-input').val()
      })
      .then(function(data) {
        window.location.pathname = data.redirect ? data.redirect : '/profile-info';
      })
      .catch(function(err) {
        alert('There was an error creating your account. Please try again');
      });
    }
    
    function validateAndCreateAccount() {
      if (!$('#email-input').val()) {
        alert('email field is blank');
      } else if (!$('#password-input').val()) {
        alert('password field is blank');
      } else if ($('#confirm-password').val() !== $('#password-input').val()) {
        alert('passwords do not match');
      } else {
        createAccount();
      }
    }

    function facebookLogin() {
      FB.login(function(response) {
        if (response.authResponse) {
          axios.post('/api/login-with-facebook', response.authResponse)
            .then(function(data) {
              window.location.pathname = data.redirect ? data.redirect : '/profile';
            })
            .catch(function(err) {
              alert('There was an error logging in. Please try again');
            });
        }
      }, {
        scope: 'email,user_birthday'
      });
    }
  </script>
</body>
</html>
